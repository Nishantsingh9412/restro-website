import{J as ae,j as e,r as ne,s as re,t as oe,v as ce,y as le,w as ie,a2 as I,q as A,R as L,a1 as z,x as de,o as C,a7 as ue,g as he,B as y,S as pe,au as xe,av as ge,aw as ye,ax as $,ay as B,az as me,aA as P}from"./chakra-B_DUJliM.js";import{r as h}from"./react-D9OIIVWL.js";import{E as De}from"./chunk-FOYGMBBW-DHh16wZn.js";import{A as fe}from"./chunk-TRO7245M-BL9_MF7v.js";import{aw as Se,ax as je,ay as we,az as be,r as V}from"./index-C674oLPn.js";import{u as Ae}from"./redux-BFEnBRFN.js";import"./toast-D556Fe1H.js";var Ce=ae({d:"M23.555,8.729a1.505,1.505,0,0,0-1.406-.98H16.062a.5.5,0,0,1-.472-.334L13.405,1.222a1.5,1.5,0,0,0-2.81,0l-.005.016L8.41,7.415a.5.5,0,0,1-.471.334H1.85A1.5,1.5,0,0,0,.887,10.4l5.184,4.3a.5.5,0,0,1,.155.543L4.048,21.774a1.5,1.5,0,0,0,2.31,1.684l5.346-3.92a.5.5,0,0,1,.591,0l5.344,3.919a1.5,1.5,0,0,0,2.312-1.683l-2.178-6.535a.5.5,0,0,1,.155-.543l5.194-4.306A1.5,1.5,0,0,0,23.555,8.729Z",displayName:"StarIcon"});const Ee=(s,r)=>async n=>{try{let a;return r?a=(await Se(s)).data:a=(await je(s)).data,n({type:"POST_EMPLOYEE_ONLY",data:a}),{success:!0,message:"Employee post Successfully",data:a}}catch(a){return{success:!1,message:a.message}}},ve=s=>async r=>{try{const{data:n}=await we(s);return r({type:"DELETE_EMPLOYEE_ONLY",data:s}),{success:!0,message:"Employee delete Successfully",data:n}}catch(n){return{success:!1,message:n.message}}},Me=()=>async s=>{try{const{data:r}=await be();return s({type:"GET_EMPLOYEE_ONLY",data:r.result}),{success:!0,message:"Employee get Successfully",data:r.result}}catch(r){return{success:!1,message:r.message}}},H=s=>s?new Date(s).toISOString().split("T")[0]:"";function ke({isOpen:s,onClose:r,actionType:n,leaveData:a,handleSubmit:c,deleteLeaveRequest:E}){const x={employeeId:"",type:"",leaveType:"",startDate:"",endDate:"",notes:"",declineAssignedShifts:!0},[D,f]=h.useState(x),S=V();h.useEffect(()=>{if(n==="edit"&&a){const{createdAt:u,emp_name:l,updatedAt:d,__v:g,...p}=a;f({...p,startDate:H(a==null?void 0:a.startDate),endDate:H(a==null?void 0:a.endDate)})}else f(u=>({...u,startDate:a==null?void 0:a.startDate}))},[n,a]);const j=u=>{const{name:l,value:d}=u.target;f(g=>({...g,[l]:d}))},O=()=>{const{leaveType:u,startDate:l,endDate:d,type:g}=D;return!u||!l||!d||!g?(S("All required fields must be filled out","error"),!1):new Date(l)>=new Date(d)?(S("End date must be greater than start date","error"),!1):!0},v=()=>{O()&&(c(D),M())},M=()=>{f(x),r()},w=(u,l,d="text",g=!1,p=[],_=!0)=>e.jsxs(e.Fragment,{children:[e.jsxs(I,{children:[u," ",_&&e.jsx("span",{style:{color:"red"},children:"*"})]}),g?e.jsx(ue,{name:l,placeholder:"Select option",mb:4,onChange:j,value:D[l]||"",children:p.map(k=>e.jsx("option",{value:k,children:k},k))}):e.jsx(A,{name:l,type:d,mb:4,onChange:j,value:D[l]||""})]});return e.jsxs(ne,{isOpen:s,onClose:M,children:[e.jsx(re,{}),e.jsxs(oe,{maxWidth:"40%",children:[e.jsx(ce,{bg:"#00a7c4",color:"white",textAlign:"center",borderTopRadius:"8px",children:n==="edit"?"Edit Leave Request":"Request Leave"}),e.jsx(le,{}),e.jsxs(ie,{pb:6,children:[e.jsx(I,{children:"Employee Name"}),e.jsx(A,{name:"name",type:"text",mb:4,value:a==null?void 0:a.emp_name,readOnly:!0}),w("Vacation Type","type","text",!0,["Paid vacation","Sick leave","Special leave","Unpaid vacation"]),w("Leave Type","leaveType","text",!0,["All Day","First Half","Second Half"]),e.jsxs(L,{spacing:4,mt:4,children:[e.jsxs(z,{children:[e.jsx(I,{children:"Start Date"}),e.jsx(A,{type:"date",name:"startDate",value:D.startDate,onChange:j})]}),e.jsxs(z,{children:[e.jsx(I,{children:"End Date"}),e.jsx(A,{type:"date",name:"endDate",value:D.endDate,onChange:j})]})]}),w("Notes","notes","text",!1,[],!1)]}),e.jsxs(de,{children:[n==="edit"&&e.jsx(C,{mr:3,colorScheme:"red",onClick:E,borderRadius:"8px",children:"Delete"}),e.jsx(C,{mr:3,colorScheme:"gray",onClick:M,borderRadius:"8px",children:"Cancel"}),e.jsx(C,{mr:3,colorScheme:"teal",onClick:v,borderRadius:"8px",color:"white",children:"Save"})]})]})]})}const m=["Daily","Weekly","Monthly"],Te=s=>[{day:s.toLocaleDateString("en-US",{weekday:"short"}),date:s.toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})}],Ie=s=>{const r=s.getDay(),n=new Date(s);return n.setDate(s.getDate()-r),new Date(n).setDate(n.getDate()+6),Array.from({length:7},(c,E)=>{const x=new Date(n);return x.setDate(n.getDate()+E),{day:x.toLocaleDateString("en-US",{weekday:"short"}),date:x.toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})}})},Le=s=>{const r=new Date(s.getFullYear(),s.getMonth(),1),n=new Date(s.getFullYear(),s.getMonth()+1,0),a=[];for(let c=r;c<=n;c.setDate(c.getDate()+1))a.push({day:new Date(c).toLocaleDateString("en-US",{weekday:"short"}),date:new Date(c).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})});return a},Oe=(s,r)=>{const n=new Date(r);if(m[s]==="Daily")return r;if(m[s]==="Weekly"){const c=n.getDate()-n.getDay();return new Date(n.setDate(c+6)).toISOString().split("T")[0]}return new Date(n.getFullYear(),n.getMonth()+1,0).toISOString().split("T")[0]};function _e(){const[s,r]=h.useState([]),{isOpen:n,onOpen:a,onClose:c}=he(),[E,x]=h.useState(null),[D,f]=h.useState(""),[S,j]=h.useState(""),[O,v]=h.useState(""),[M,w]=h.useState(!1),u=Ae(),l=V(),[d,g]=h.useState(new Date().toISOString().split("T")[0]),[p,_]=h.useState(1),k=()=>{const t=new Date(d),o={Daily:new Date(t.setDate(t.getDate()-1)),Weekly:new Date(t.setDate(t.getDate()-7)),Monthly:new Date(t.setMonth(t.getMonth()-1))};g(o[m[p]])},G=()=>g(J()),J=()=>{const t=new Date(d);return{Daily:new Date(t.setDate(t.getDate()+1)),Weekly:new Date(t.setDate(t.getDate()+7)),Monthly:new Date(t.setMonth(t.getMonth()+1))}[m[p]].toISOString().split("T")[0]},Z=t=>{const o=t.target.value;isNaN(new Date(o).getTime())||g(o)},K=()=>_((p+m.length-1)%m.length),F=m[p]==="Daily"?Te(new Date(d)):m[p]==="Weekly"?Ie(new Date(d)):Le(new Date(d)),U=t=>{const o=new Date(t).toISOString().split("T")[0],[N,T,b]=o.split("-");return`${b}-${T}-${N}`},R=async()=>{const t=await u(Me());t.success&&r(t.data)},Q=async t=>{t.employeeId=D;try{const o=await u(Ee(t,S));o.success?(l(S?"Absence Updated successfully":"Absence Add successfully","success"),c(),await R()):console.error("Failed to add employee leave:",o.message)}catch(o){console.error("Failed to add employee leave:",o)}},X=async()=>{try{if(!S){l("All fields are required","error");return}await u(ve({_id:S})),l("Absence deleted successfully","success"),c(),await R()}catch(t){console.error("Failed to delete employee leave:",t)}};h.useEffect(()=>{w(!0),R().finally(()=>w(!1))},[]);const ee=()=>{x(null),j(""),f(""),v(""),c()};return M?e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(pe,{size:"xl"})}):e.jsxs(h.Fragment,{children:[e.jsx(y,{display:"flex",justifyContent:"center",mb:4,children:e.jsxs(L,{spacing:4,children:[e.jsx(y,{bg:"#00A7C4",height:"20px",width:"20px",borderRadius:"4px"}),e.jsx("span",{children:"Paid Vacation"}),e.jsx(y,{bg:"#F8C150",height:"20px",width:"20px",borderRadius:"4px"}),e.jsx("span",{children:"Sick"}),e.jsx(y,{bg:"#543EAC",height:"20px",width:"20px",borderRadius:"4px"}),e.jsx("span",{children:"Special leave"}),e.jsx(y,{bg:"#FF910A",height:"20px",width:"20px",borderRadius:"4px"}),e.jsx("span",{children:"Unpaid vacation"})]})}),e.jsxs(y,{overflow:"auto",whiteSpace:"nowrap",mt:8,children:[e.jsxs(L,{justifyContent:"center",mb:4,children:[e.jsx(A,{type:"date",value:d,onChange:Z,padding:2,borderRadius:5,border:"1px solid gray",cursor:"pointer"}),e.jsx("span",{children:"to"}),e.jsx(A,{disabled:!0,type:"date",value:Oe(p,d),padding:2,borderRadius:5,cursor:"not-allowed",bg:"lightgray",border:"1px solid gray"})]}),e.jsxs(L,{justifyContent:"center",mb:4,children:[e.jsx(C,{onClick:k,children:"Previous"}),e.jsxs(C,{onClick:K,children:["View Mode: ",m[p]]}),e.jsx(C,{onClick:G,children:"Next"})]}),e.jsx(xe,{bg:"white",p:4,borderRadius:"8px",boxShadow:"md",children:e.jsxs(ge,{variant:"simple",size:"md",children:[e.jsx(ye,{children:e.jsxs($,{children:[e.jsx(B,{border:"1px solid #000000",fontWeight:"800",fontSize:"14px",children:"Employee Name"}),F.map((t,o)=>e.jsx(B,{border:"1px solid #000000",fontWeight:"800",fontSize:"14px",children:`${t.day}, ${t.date}`},o))]})}),e.jsx(me,{children:s&&s.length>0?s.map(t=>e.jsxs($,{children:[e.jsx(P,{fontSize:"14px",fontWeight:"600",border:"1px solid #c5bcbc",children:t.name}),F.map((o,N)=>{const T=new Date(o.date).toLocaleDateString(),b=new Date(o==null?void 0:o.date)>new Date(new Date().setDate(new Date().getDate()+1)),q=t.absences.filter(i=>{const W=new Date(i.startDate).toLocaleDateString(),Y=new Date(i.endDate).toLocaleDateString();return T>=W&&T<=Y});return e.jsx(P,{fontSize:"14px",fontWeight:"800",textAlign:"center",border:"1px solid #c5bcbc",className:"add_hover",_hover:{bg:"gray.200"},children:q.length>0?e.jsx(y,{display:"flex",flexDirection:"column",alignItems:"center",children:q.map(i=>e.jsxs(y,{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",mb:2,children:[e.jsx(Ce,{color:i.type==="Paid vacation"?"#00A7C4":i.type==="Sick leave"?"#f8c150":i.type==="Special leave"?"#543eac":i.type==="Unpaid vacation"?"#ff910a":""})," ",`${U(i.startDate)} — ${U(i.endDate)}`,"   ",e.jsx(De,{cursor:b?"pointer":"not-allowed",onClick:()=>{if(!b){l("You can't edit absence for past dates or within 24 hours","error");return}f(t._id),j(i._id),x({...i,emp_name:t.name}),v("edit"),a()},className:"edit_icon_hover",sx:{marginRight:"10px",color:"black"}})]},i._id))}):e.jsx(fe,{cursor:b?"pointer":"not-allowed",onClick:()=>{if(b){const i=new Date(o.date),W=i.getFullYear(),Y=String(i.getMonth()+1).padStart(2,"0"),te=String(i.getDate()).padStart(2,"0"),se=`${W}-${Y}-${te}`;v("add"),f(t._id),x({emp_name:t.name,startDate:se}),a()}else l("You can't add absence for past dates or within 24 hours","error")},className:"add_icon_hover",sx:{marginRight:"10px",color:"black"}})},N)})]},t._id)):e.jsx($,{children:e.jsx(P,{colSpan:F.length+1,textAlign:"center",children:"No employees found"})})})]})})]}),e.jsx(ke,{onClose:ee,isOpen:n,actionType:O,leaveData:E,handleSubmit:Q,deleteLeaveRequest:X})]})}function Ue(){return e.jsx(_e,{})}export{Ue as default};
