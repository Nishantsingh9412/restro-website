import{u as q,h as Le,j as e,F as B,S as oe,M as Ee,i as Pe,A as Me,k as Te,b as f,l as se,n as Fe,o as g,p as ne,q as Ne,r as le,s as ce,t as de,v as ue,w as he,x as xe,P as b,B as O,a as _e,c as Be,d as re,f as ae,L as We,y as ze,g as Ae}from"./chakra-B_DUJliM.js";import{j as He,S as qe,a as Ue,F as Ye}from"./Sidebar-4LytmxK3.js";import{h as Je,r,u as Ve,O as Ge}from"./react-D9OIIVWL.js";import{u as fe,f as G}from"./redux-BFEnBRFN.js";import{l as De,b as Ke,u as ie,d as Qe,e as Xe,f as Ze,g as $e,s as T,a as et,h as tt,c as ot,i as st,j as nt,k as rt,m as at,n as it,o as lt,w as ct}from"./index-C674oLPn.js";import{S as dt}from"./SidebarRight-DkF_BAGu.js";import"./index.esm-C2w5JDxg.js";import"./toast-D556Fe1H.js";/* empty css                      */import"./formatDistanceToNow-Coq_Dh7D.js";import"./normalizeDates-DLvNHQ5D.js";import"./en-US-DoJHY7yM.js";const _=({isOpen:m,onClose:j,title:d,body:u,footer:i})=>e.jsxs(le,{isOpen:m,onClose:j,children:[e.jsx(ce,{}),e.jsxs(de,{children:[e.jsx(ue,{children:d}),e.jsx(he,{children:u}),e.jsx(xe,{children:i})]})]});_.propTypes={isOpen:b.bool.isRequired,onClose:b.func.isRequired,title:b.string.isRequired,body:b.node,footer:b.node.isRequired};function ut(){const m=q("white","navy.800"),j=q("14px 17px 40px 4px rgba(112, 144, 176, 0.18)","14px 17px 40px 4px rgba(112, 144, 176, 0.06)"),d=fe(),u=Je(),i=Le(),x=JSON.parse(localStorage.getItem("ProfileData")),s=G(t=>{var a;return(a=t==null?void 0:t.userReducer)==null?void 0:a.data}),v=G(t=>{var a;return(a=t==null?void 0:t.employee)==null?void 0:a.error}),[p,k]=r.useState((s==null?void 0:s.is_online)||!1),[h,R]=r.useState(null),[C,o]=r.useState(!1),[l,n]=r.useState(!1),[c,E]=r.useState(!1),[D,I]=r.useState(!1),[L,W]=r.useState(null),[S,z]=r.useState(null),[pe,Z]=r.useState(!1),[F,$]=r.useState(null),[ge,N]=r.useState(!1),[U,ee]=r.useState(""),[A,Y]=r.useState(null),[J,be]=r.useState(null),je=(t,a)=>{const w=Ie=>Ie*Math.PI/180,P=w(a.latitude-t.latitude),M=w(a.longitude-t.longitude),H=Math.sin(P/2)*Math.sin(P/2)+Math.cos(w(t.latitude))*Math.cos(w(a.latitude))*Math.sin(M/2)*Math.sin(M/2);return 6371*(2*Math.atan2(Math.sqrt(H),Math.sqrt(1-H)))*1e3},ve=t=>{d($e(t)),T.emit("sendLocation",{delEmpId:s==null?void 0:s._id,adminId:s==null?void 0:s.created_by,location:t})},we=r.useCallback(()=>{let t=null;const a=()=>{navigator.geolocation.getCurrentPosition(w=>{var H,X;const{latitude:y,longitude:P}=w.coords,M=h??{latitude:(H=s==null?void 0:s.lastLocation)==null?void 0:H.lat,longitude:(X=s==null?void 0:s.lastLocation)==null?void 0:X.lng};(!M||je(M,{latitude:y,longitude:P})>50)&&(R({latitude:y,longitude:P}),ve({latitude:y,longitude:P}))},w=>{if(w.code===1?i({title:"Permission Denied",description:"Please enable location access to send live location.",status:"error"}):(console.error("Geolocation error:",w),i({title:"Error",description:"Failed to get location data",status:"error"})),t){clearInterval(t);return}},{enableHighAccuracy:!0})};return a(),J||(t=setInterval(a,1e4),be(t)),()=>{clearInterval(t)}},[h,s]),K=r.useCallback(()=>{d(De()),d(Ke()),clearInterval(J),u("/")},[d,u]),Q=r.useCallback(async()=>{const t=new FormData;t.append("is_online",!0),t.append("latitude",h==null?void 0:h.latitude),t.append("longitude",h==null?void 0:h.longitude),t.append("adminId",s==null?void 0:s.created_by),t.append("live_photo",L,"photo.jpg");try{const a=await d(ie(t));if(a.error)throw new Error(a.error.message||"Something went wrong");i({title:"Online",description:"You are now online",status:"success"}),W(null),k(!0)}catch(a){console.error(a),i({title:"Error",description:a.message,status:"error"})}},[d,h,L,i]),ye=async t=>{const a=t.target.checked;n(!0),a?E(!0):(await d(ie({is_online:!1})),i({title:"Offline",description:"You are now offline",status:"info"}),k(!1)),n(!1)},Ce=()=>{o(!0),navigator.geolocation.getCurrentPosition(t=>{R({latitude:t.coords.latitude,longitude:t.coords.longitude}),V(),I(!0)},()=>{i({title:"Location Permission Denied",description:"Please enable location access to proceed.",status:"error",duration:4e3,isClosable:!0}),n(!1)}),E(!1),o(!1)},V=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:!0});z(t)}catch{i({title:"Camera Permission Denied",description:"Please enable camera access to proceed.",status:"error",duration:4e3,isClosable:!0}),n(!1)}},Se=async()=>{I(!1),(s==null?void 0:s.role)==="Delivery Boy"?(V(),N(!0)):(W(null),await Q())},te=(t,a)=>{const w=S.getVideoTracks()[0],y=document.createElement("canvas");y.width=F.videoWidth,y.height=F.videoHeight,y.getContext("2d").drawImage(F,0,0,y.width,y.height),y.toBlob(M=>{t(M),z(null),w.stop(),Z(!1)},"image/jpeg"),a()},Oe=()=>{Z(!0),te(W,()=>I(!1))},ke=()=>{if(!U){i({title:"Error",description:"Please enter odometer reading",status:"error"});return}te(Y,()=>N(!1))},Re=r.useCallback(async()=>{const t=new FormData;t.append("odometer_reading",U),t.append("odometer_photo",A,"odometer.jpg");try{const a=await d(Qe(t));if(a.error)throw new Error(a.error.message||"Something went wrong");i({title:"Odometer Submitted",description:"Your odometer reading has been successfully submitted.",status:"success"}),await Q(),N(!1),ee(""),Y(null)}catch(a){console.error(a),i({title:"Error",description:"Failed to submit odometer data",status:"error"})}},[d,U,A,Q,i]);return r.useEffect(()=>{v&&(i({title:"Error",description:v,status:"error",duration:4e3,isClosable:!0}),d(Xe()))},[d,v,i]),r.useEffect(()=>{F&&S&&(F.srcObject=S)},[S,F]),r.useEffect(()=>{const t=x==null?void 0:x.token;t&&He(t).exp*1e3<Date.now()&&K()},[K,x==null?void 0:x.token]),r.useEffect(()=>{s!=null&&s.is_online&&k(!0)},[s]),r.useEffect(()=>(p&&(s==null?void 0:s.role)===Ze.DELIVERY_BOY?we():clearInterval(J),()=>{clearInterval(J)}),[p]),pe?e.jsx(B,{justifyContent:"center",alignItems:"center",children:e.jsx(oe,{size:"md"})}):e.jsxs(e.Fragment,{children:[e.jsx(B,{w:{sm:"100%",md:"auto"},alignItems:"center",flexDirection:"row",p:"10px",borderRadius:"30px",boxShadow:j,children:e.jsxs(Ee,{children:[e.jsx(Pe,{children:e.jsx(Me,{color:"white",name:(s==null?void 0:s.name)||"Employee",bg:"#11047A",size:"sm",w:"40px",h:"40px"})}),e.jsxs(Te,{boxShadow:j,mt:"10px",bg:m,border:"none",children:[e.jsxs(f,{ps:"10px",pt:"16px",pb:"10px",fontSize:"sm",fontWeight:"700",children:["ðŸ‘‹ Hey, ",(s==null?void 0:s.name)||"Employee"]}),e.jsxs(se,{children:[e.jsx(f,{fontSize:"sm",mr:10,children:"Go Online"}),e.jsx(Fe,{isChecked:p,onChange:ye,isDisabled:l})]}),e.jsx(se,{color:"red.400",onClick:K,children:e.jsx(f,{fontSize:"sm",children:"Log out"})})]})]})}),e.jsx(_,{isOpen:c,onClose:()=>E(!1),title:"Location Permission",body:"Please grant location access to proceed.",footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{colorScheme:"blue",onClick:Ce,children:C?e.jsx(oe,{size:"sm"}):"Allow"}),e.jsx(g,{variant:"ghost",onClick:()=>E(!1),children:"Cancel"})]})}),e.jsx(_,{isOpen:D,onClose:()=>{I(!1),S&&(S.getTracks().forEach(t=>t.stop()),z(null))},title:"Camera Preview",body:e.jsx("video",{ref:t=>$(t),autoPlay:!0,style:{width:"100%"}}),footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{colorScheme:"blue",onClick:Oe,children:"Capture"}),e.jsx(g,{variant:"ghost",onClick:()=>{I(!1),S&&(S.getTracks().forEach(t=>t.stop()),z(null))},children:"Cancel"})]})}),e.jsx(_,{isOpen:!!L,onClose:()=>W(null),title:"Preview Photo",body:L&&e.jsx(ne,{src:URL.createObjectURL(L),alt:"Preview"}),footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{colorScheme:"blue",onClick:Se,children:"Confirm"}),e.jsx(g,{variant:"ghost",onClick:()=>{W(null),I(!0),V()},children:"Retake"})]})}),e.jsx(_,{isOpen:!!A,onClose:()=>Y(null),title:"Preview Odometer",body:A&&e.jsx(ne,{src:URL.createObjectURL(A),alt:"Preview"}),footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{colorScheme:"blue",onClick:Re,children:"Confirm"}),e.jsx(g,{variant:"ghost",onClick:()=>{Y(null),N(!0),V()},children:"Retake"})]})}),e.jsx(_,{isOpen:ge,onClose:()=>N(!1),title:"Odometer Reading",body:e.jsxs(e.Fragment,{children:[e.jsx(Ne,{placeholder:"Enter Odometer Reading",value:U,onChange:t=>ee(t.target.value),required:!0,mb:4}),e.jsx("video",{ref:t=>$(t),autoPlay:!0,style:{width:"100%"}})]}),footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{colorScheme:"blue",onClick:ke,children:"Capture Odometer Photo"}),e.jsx(g,{variant:"ghost",onClick:()=>{N(!1),S&&(S.getTracks().forEach(t=>t.stop()),z(null))},children:"Cancel"})]})})]})}function me(m){const[j,d]=r.useState(!1),u=r.useCallback(()=>{d(window.scrollY>1)},[]);r.useEffect(()=>(window.addEventListener("scroll",u),()=>{window.removeEventListener("scroll",u)}),[u]);const{secondary:i,message:x,brandText:s}=m,v=q("white","white"),p=q("gray.200","white"),k=q("var(--primary)","rgba(11,20,55,0.5)");return e.jsxs(O,{position:"absolute",boxShadow:"none",bg:k,borderColor:"transparent",filter:"none",backdropFilter:"blur(20px)",borderRadius:"40px",borderWidth:"1.5px",borderStyle:"solid",transition:"box-shadow 0.25s linear, background-color 0.25s linear, filter 0.25s linear, border 0.25s linear",alignItems:{xl:"center"},display:i?"block":"flex",minH:"75px",justifyContent:{xl:"center"},flexDirection:{lg:"row",base:"column"},lineHeight:"25.6px",mx:"auto",mt:i?"0px":"20px",p:"20px",gap:"10px",right:"5%",top:{base:"12px",md:"16px",lg:"20px",xl:"20px"},w:"90%",zIndex:2,children:[e.jsxs(B,{alignItems:"center",justifyContent:"space-between",gap:"10px",me:"10px",color:"#fff",display:{xl:"none",base:"flex"},w:"100%",children:[e.jsxs(B,{alignItems:"center",gap:"10px",children:[e.jsx(_e,{src:"",w:"50px",h:"50px",alt:"Employee Logo"}),e.jsxs(O,{children:[e.jsx(f,{children:"Hello"}),e.jsx(f,{children:"Employee Name"})]})]}),e.jsx(qe,{routes:et})]}),e.jsxs(B,{w:"100%",flexDirection:{sm:"column",md:"row"},alignItems:{xl:"center"},mb:"0px",children:[e.jsxs(O,{mb:{sm:"8px",md:"0px"},display:{xl:"block",base:"none"},children:[e.jsxs(Be,{children:[e.jsx(re,{color:p,fontSize:"sm",mb:"5px",children:e.jsx(ae,{href:"#",color:p,children:"Pages"})}),e.jsx(re,{color:p,fontSize:"sm",mb:"5px",children:e.jsx(ae,{href:"#",color:p,children:s})})]}),e.jsx(We,{color:v,href:"#",bg:"inherit",borderRadius:"inherit",fontWeight:"bold",fontSize:"34px",_hover:{color:v},_active:{bg:"inherit",transform:"none",borderColor:"transparent"},_focus:{boxShadow:"none"},children:s})]}),e.jsx(O,{ms:"auto",w:{sm:"100%",md:"unset"},children:e.jsx(ut,{onOpen:m.onOpen,logoText:m.logoText,secondary:m.secondary,fixed:m.fixed,scrolled:j})})]}),i&&e.jsx(f,{color:"white",children:x})]})}me.propTypes={brandText:b.string,variant:b.string,secondary:b.bool,fixed:b.bool,onOpen:b.func,message:b.string,logoText:b.string};const ht=()=>{const m=fe(),j=G(n=>{var c;return(c=n.deliveryBoy)==null?void 0:c.deliveryOffer}),d=G(n=>n.userReducer.data),{isOfferModalOpen:u,orderOfferDetails:i,supplierId:x}=j,{orderId:s,name:v,dropLocationName:p,noteFromCustomer:k}=i,[h,R]=r.useState(10),C=()=>{m(tt())},o=()=>{T.emit("acceptOrder",{delEmpId:d==null?void 0:d._id,supplierId:x,orderId:s}),C()},l=()=>{C()};return r.useEffect(()=>{if(u){R(10);const n=setInterval(()=>{R(c=>c<=1?(clearInterval(n),C(),0):c-1)},1e3);return()=>clearInterval(n)}},[u]),e.jsxs(le,{isOpen:u,onClose:C,children:[e.jsx(ce,{}),e.jsxs(de,{children:[e.jsx(ue,{children:"Delivery Order"}),e.jsx(ze,{}),e.jsxs(he,{children:[e.jsx(O,{mb:4,children:e.jsxs(f,{fontWeight:"bold",children:["Order ID:"," ",e.jsx(f,{as:"span",fontWeight:"normal",children:s})]})}),e.jsx(O,{mb:4,children:e.jsxs(f,{fontWeight:"bold",children:["Customer Name:"," ",e.jsx(f,{as:"span",fontWeight:"normal",children:v})]})}),e.jsx(O,{mb:4,children:e.jsxs(f,{fontWeight:"bold",children:["Drop Location:"," ",e.jsx(f,{as:"span",fontWeight:"normal",children:p})]})}),e.jsx(O,{mb:4,children:e.jsxs(f,{fontWeight:"bold",children:["Customer Note:"," ",e.jsx(f,{as:"span",fontWeight:"normal",children:k})]})})]}),e.jsxs(xe,{children:[e.jsxs(g,{colorScheme:"green",mr:3,onClick:o,children:["Accept (",h,"s)"]}),e.jsx(g,{colorScheme:"red",onClick:l,children:"Reject"})]})]})]})};function Ot(m){const{...j}=m,[d]=r.useState(!1),[u,i]=r.useState([]),x=Ve(),{onOpen:s}=Ae(),[v,p]=r.useState(null);r.useEffect(()=>{var l,n,c,E;const o=JSON.parse(localStorage.getItem("ProfileData"));return p((n=(l=o==null?void 0:o.result)==null?void 0:l.role)==null?void 0:n.toLowerCase()),console.log("Role:",(E=(c=o==null?void 0:o.result)==null?void 0:c.role)==null?void 0:E.toLowerCase()),ot(),T.on("connect",()=>{var I;console.log("Socket Connected"),T.emit("userJoined",(I=o==null?void 0:o.result)==null?void 0:I._id);const D=setInterval(()=>{var L;T.emit("heartbeat",(L=o==null?void 0:o.result)==null?void 0:L._id)},1e4);return()=>{clearInterval(D)}}),()=>{T.off("connect"),T.disconnect()}},[]),r.useEffect(()=>{i(k(v))},[v]);const k=o=>{switch(o){case"waiter":return ct;case"delivery boy":return lt;case"manager":return it;case"chef":return at;case"staff":return rt;case"bar tender":return nt;case"helper":return st;case"custom":return[];default:return[]}},h=o=>{const l="Default Brand Text";for(let n=0;n<o.length;n++)if(o[n].collapse){const c=h(o[n].items);if(c!==l)return c}else if(o[n].links){const c=h(o[n].links);if(c!==l)return c}else if(x.pathname===o[n].layout+o[n].path)return o[n].name;return l},R=o=>{for(let l=0;l<o.length;l++)if(o[l].collapse){const n=R(o[l].items);if(n)return n}else if(o[l].category){const n=R(o[l].items);if(n)return n}else if(x.pathname===o[l].layout+o[l].path)return o[l].secondary;return!1},C=o=>{const l="Default Navbar Text";for(let n=0;n<o.length;n++)if(o[n].collapse){const c=C(o[n].items);if(c!==l)return c}else if(o[n].category){const c=C(o[n].items);if(c!==l)return c}else if(x.pathname===o[n].layout+o[n].path)return o[n].messageNavbar;return l};return e.jsxs(B,{bg:"var(--primary-bg)",h:"100%",children:[e.jsx(Ue,{routes:u,display:"none",...j}),e.jsxs(O,{minHeight:"100vh",overflow:"auto",position:"relative",flex:"1",pb:"80px",children:[e.jsx(me,{onOpen:s,logoText:"Horizon UI Dashboard PRO",brandText:h(u),secondary:R(u),message:C(u),fixed:d,...j}),e.jsx(ht,{isOpen:!0,onClose:()=>{},order:{}}),e.jsx(O,{mt:"130px",p:"20px",children:e.jsx(Ge,{})}),e.jsx(Ye,{})]}),e.jsx(dt,{})]})}export{Ot as default};
