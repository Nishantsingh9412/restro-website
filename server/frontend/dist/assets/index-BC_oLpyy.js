import{g as P,j as e,B as R,S as U,R as F,q as _,o as y,au as V,av as H,aw as Z,ax as M,ay as Y,az as G,aA as O,r as J,s as K,t as Q,v as X,y as ee,w as te,a1 as S,a2 as D,a7 as I,af as se,x as ae}from"./chakra-B_DUJliM.js";import{r as p}from"./react-D9OIIVWL.js";import{E as re}from"./chunk-FOYGMBBW-DHh16wZn.js";import{A as ne}from"./chunk-TRO7245M-BL9_MF7v.js";import{u as oe}from"./redux-BFEnBRFN.js";import{g as ie}from"./employee-DTRKjokn.js";import{as as le,at as de,au as ce,av as ue,r as he}from"./index-C674oLPn.js";import"./toast-D556Fe1H.js";const me=(o,n)=>async a=>{try{let r;return n?r=(await le(o)).data:r=(await de(o)).data,a({type:"POST_EMPLOYEE_ONLY",data:r}),{success:!0,message:"Employee post Successfully",data:r}}catch(r){return{success:!1,message:r.response.data.error||"something went wrong",status:r.response.status}}},fe=o=>async n=>{try{const{data:a}=await ce(o);return n({type:"DELETE_EMPLOYEE_ONLY",data:o}),{success:!0,message:"Employee delete Successfully",data:a}}catch(a){return{success:!1,message:a.response.data.error||"something went wrong",status:a.response.status}}},pe=()=>async o=>{try{const{data:n}=await ue();return o({type:"GET_EMPLOYEE_ONLY",data:n.result}),{success:!0,message:"Employee get Successfully",data:n.result}}catch(n){return{success:!1,message:n.response.data.error||"something went wrong",status:n.response.status}}},u=["Daily","Weekly","Monthly"],W=Array.from({length:24},(o,n)=>`${n.toString().padStart(2,"0")}:00`),ge=(o,n)=>{const a=new Date(n);switch(o){case"Weekly":return Array.from({length:7},(r,h)=>{const m=new Date(a);return new Date(m.setDate(a.getDate()-a.getDay()+h))});case"Monthly":{const r=new Date(a.getFullYear(),a.getMonth(),1);return Array.from({length:new Date(a.getFullYear(),a.getMonth()+1,0).getDate()},(h,m)=>new Date(r.getFullYear(),r.getMonth(),m+1))}default:return[new Date(a)]}},xe=()=>{const{isOpen:o,onOpen:n,onClose:a}=P(),r=oe(),h={_id:"",from:"",to:"",note:"",employeeId:null,date:""},[m,L]=p.useState([]),[g,E]=p.useState(new Date().toISOString().split("T")[0]),[f,z]=p.useState(1),[B,N]=p.useState(!0),[s,d]=p.useState(h),c=he(),v=async()=>{const t=await r(ie()),i=await r(pe());t.success&&L(t.data),i.success&&L(i.data),N(!1)};p.useEffect(()=>{v()},[r]);const w=()=>{d(h),a()},q=async()=>{const t=new Date(`1970-01-01T${s.from}:00`);(new Date(`1970-01-01T${s.to}:00`)-t)/(1e3*60*60)<1&&c("The shift duration must be at least 1 hour.","error");const{date:l,employeeId:x,from:C,to:j,_id:b}=s;if(!l||!x||!C||!j)return c("All fields are required","error");const A=await r(me(s,b));w(),A.success?(v(),c(b?"Shift updated successfully":"Shift added successfully","success")):c(A.message,"error")},$=async()=>{if(!s._id)return c("Shift not found","error");const t=await r(fe({_id:s._id}));w(),t.success&&c("Shift deleted successfully","success")&&v()},T=ge(u[f],g);return B?e.jsx(R,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(U,{size:"xl"})}):e.jsxs(p.Fragment,{children:[e.jsxs(R,{overflow:"auto",whiteSpace:"nowrap",mt:16,mb:8,children:[e.jsxs(F,{justifyContent:"center",mb:4,children:[e.jsx(_,{type:"date",value:g,onChange:t=>E(t.target.value),padding:2,borderRadius:5,border:"1px solid gray",cursor:"pointer"}),e.jsx("span",{children:"to"}),e.jsx(_,{disabled:!0,type:"date",value:T.slice(-1)[0].toISOString().split("T")[0],padding:2,borderRadius:5,cursor:"not-allowed",bg:"lightgray",border:"1px solid gray"})]}),e.jsxs(F,{justifyContent:"center",mb:4,children:[e.jsx(y,{onClick:()=>E(new Date(g).setDate(new Date(g).getDate()-(u[f]==="Daily"?1:u[f]==="Weekly"?7:30))),children:"Previous"}),e.jsxs(y,{onClick:()=>z((f+u.length-1)%u.length),children:["View Mode: ",u[f]]}),e.jsx(y,{onClick:()=>E(new Date(g).setDate(new Date(g).getDate()+(u[f]==="Daily"?1:u[f]==="Weekly"?7:30))),children:"Next"})]}),e.jsx(V,{bg:"white",p:4,borderRadius:"8px",boxShadow:"md",children:e.jsxs(H,{variant:"simple",size:"md",children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(Y,{border:"1px solid #000000",fontWeight:"800",fontSize:"14px",children:"Employee Name"}),T.map((t,i)=>e.jsx(Y,{border:"1px solid #000000",fontWeight:"800",fontSize:"14px",children:t.toLocaleDateString("en-US",{weekday:"short",day:"numeric",month:"short",year:"numeric"})},i))]})}),e.jsx(G,{children:m.length?m.map(t=>e.jsxs(M,{children:[e.jsx(O,{border:"1px solid #ababab",fontWeight:"800",fontSize:"14px",children:t.name}),T.map((i,k)=>{var C;const l=(C=t.shifts)==null?void 0:C.find(j=>new Date(j.date).toLocaleDateString()===i.toLocaleDateString()),x=new Date(i)>new Date(new Date().setDate(new Date().getDate()+1));return e.jsx(O,{textAlign:"center",border:"1px solid #ababab",fontWeight:"800",fontSize:"14px",_hover:{bg:"gray.200"},children:l?e.jsxs(e.Fragment,{children:[`${new Date(l.from).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:"UTC"})} - ${new Date(l.to).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:"UTC"})}`,"   ",e.jsx(re,{mb:"4px",cursor:x?"pointer":"not-allowed",onClick:()=>{if(x){const j=new Date(l.from).toISOString().slice(11,16),b=new Date(l.to).toISOString().slice(11,16);d({_id:l._id,from:j,to:b,note:l.note,employeeId:t._id,date:i.toISOString().split("T")[0]}),n()}else c("Cannot edit shift for past dates or within 24 hours.","error")}})]}):e.jsx(ne,{cursor:x?"pointer":"not-allowed",onClick:()=>{x?(d({employeeId:t._id,date:i.toISOString().split("T")[0]}),n()):c("Cannot add shift for past dates or within 24 hours.","error")}})},k)})]},t._id)):e.jsx(M,{children:e.jsx(O,{colSpan:T.length+1,children:"No employees found"})})})]})})]}),e.jsxs(J,{isOpen:o,onClose:w,children:[e.jsx(K,{}),e.jsxs(Q,{children:[e.jsxs(X,{children:[s._id?"Edit":"Add"," Shift"]}),e.jsx(ee,{}),e.jsxs(te,{children:[e.jsxs(S,{isRequired:!0,children:[e.jsx(D,{children:"Employee"}),e.jsxs(I,{disabled:!0,value:s.employeeId||"",onChange:t=>d({...s,employeeId:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Employee"}),m.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs(S,{mt:4,isRequired:!0,children:[e.jsx(D,{children:"Date"}),e.jsx(_,{type:"date",value:s.date||"",onChange:t=>d({...s,date:t.target.value})})]}),e.jsxs(S,{mt:4,isRequired:!0,children:[e.jsx(D,{children:"From Time"}),e.jsx(I,{value:s.from||"",onChange:t=>d({...s,from:t.target.value}),children:W.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs(S,{mt:4,isRequired:!0,children:[e.jsx(D,{children:"To Time"}),e.jsx(I,{value:s.to||"",onChange:t=>d({...s,to:t.target.value}),children:W.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs(S,{mt:4,children:[e.jsx(D,{children:"Note"}),e.jsx(se,{value:s.note,onChange:t=>d({...s,note:t.target.value})})]})]}),e.jsxs(ae,{children:[e.jsx(y,{colorScheme:"blue",mr:3,onClick:q,children:s._id?"Update":"Add"}),e.jsx(y,{colorScheme:"gray",mr:3,onClick:w,children:"Cancel"}),s._id&&e.jsx(y,{colorScheme:"red",onClick:$,children:"Delete"})]})]})]})]})};function Ee(){return e.jsx(xe,{})}export{Ee as default};
