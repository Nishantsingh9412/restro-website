import{P as _,j as e,r as Z,s as K,t as J,v as X,o as N,y as ee,w as se,z as le,F as T,b as t,x as ne,B as I,H as h,O as R,ao as Y,V as G,ac as c,ap as F,a5 as L,S as re,Z as te,_ as ie,$ as B,aq as oe,ar as M,a8 as z}from"./chakra-B_DUJliM.js";import{r as x}from"./react-D9OIIVWL.js";import{u as ce,f as E}from"./redux-BFEnBRFN.js";import{g as ae,b as de,c as he,d as me}from"./takeAwayOrder-BoBAlo1H.js";import{F as xe}from"./ForbiddenPage-DOSjSRWN.js";import{r as Q,ab as ue,ac as je,ad as be,ae as W,f as w}from"./index-C674oLPn.js";import{a as $,b as H,g as ge,c as pe}from"./dineInOrder-Qshl_rwx.js";import{C as fe,A as ye}from"./AllotOrderModal-ut9QwBD-.js";import"./index.esm-CEhDG2xH.js";import"./toast-D556Fe1H.js";function U({isOpen:r,setIsOpen:o,onSubmit:v,orderId:u}){const m=Q(),[i,j]=x.useState([]),[l,g]=x.useState([]),[y,b]=x.useState(!0),p=n=>{g(a=>a.includes(n)?a.filter(C=>C!==n):[...a,n])},f=()=>{v(i.filter(n=>l.includes(n._id))),o(!1)},A=()=>{je({id:u,deliveryBoyIds:l}).then(()=>{m("Delivery offer sent","success")})},O=()=>{l.length===i.length?g([]):g(i.map(n=>n._id))};return x.useEffect(()=>{r&&(async()=>{var a,C,D;try{b(!0);const S=await be(u);j((a=S==null?void 0:S.data)!=null&&a.result.length?S.data.result:[])}catch(S){m((D=(C=S==null?void 0:S.response)==null?void 0:C.data)==null?void 0:D.error,"info")}finally{b(!1)}})(),g([])},[r,u,m]),e.jsxs(Z,{isOpen:r,onClose:()=>o(!1),isCentered:!0,children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(X,{children:"Allot Delivery Boys "}),e.jsx(N,{ml:1,variant:"ghost",position:"absolute",display:y?"none":"block",top:4,left:48,onClick:O,colorScheme:l.length===i.length?"green":"gray",width:"fit-content",leftIcon:l.length===i.length?e.jsx($,{}):e.jsx(H,{})}),e.jsx(ee,{}),e.jsx(se,{children:y?e.jsxs(le,{my:20,display:"flex",flexDirection:"column",gap:2,children:[e.jsx(fe,{}),"Loading..."]}):i.length?e.jsx(T,{flexDirection:"column",gap:5,maxH:"400px",overflowY:"auto",children:i.map(n=>{var a;return e.jsxs(T,{gap:5,alignItems:"center",children:[e.jsx(N,{onClick:()=>p(n._id),colorScheme:l.includes(n._id)?"green":"gray",width:"fit-content",leftIcon:l.includes(n._id)?e.jsx($,{}):e.jsx(H,{}),children:n.name}),e.jsxs(t,{color:l.includes(n._id)?"green":"#ccc",children:["Distance: ",(a=n==null?void 0:n.distance)==null?void 0:a.toFixed(1)," KM"]})]},n._id)})}):e.jsx(t,{my:20,mx:"auto",width:"fit-content",textAlign:"center",color:"#999",children:"No delivery boys are available at this moment"})}),!y&&e.jsxs(ne,{children:[e.jsx(N,{variant:"ghost",mr:3,onClick:()=>o(!1),children:"Cancel"}),e.jsx(N,{colorScheme:"blue",disabled:!l.length,onClick:f,pointerEvents:l.length===1?"auto":"none",bg:l.length===1?"blue.500":"gray.300",children:"Allot"}),e.jsx(N,{colorScheme:"teal",ml:3,disabled:l.length<2,onClick:()=>{o(!1),ue.showCustomAlert("Send Delivery Offer","Are you sure you want to send delivery offer to all delivery","center",A)},pointerEvents:l.length>=2?"auto":"none",bg:l.length>=2?"teal.500":"gray.400",children:"Allot All"})]})]})]})}U.propTypes={isOpen:_.bool.isRequired,setIsOpen:_.func.isRequired,onSubmit:_.func.isRequired,orderId:_.string};const Ae=({orderData:r,handleAllotWaiter:o})=>{const{_id:v,completedAt:u,assignedWaiter:m,orderId:i,customerName:j,phoneNumber:l,emailAddress:g,numberOfGuests:y,specialRequests:b,totalPrice:p,tableNumber:f,orderItems:A}=r;return e.jsxs(I,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",p:"6",bg:"white",shadow:"lg",transition:"transform 0.2s",_hover:{transform:"scale(1.02)"},children:[u?e.jsx(h,{as:"h2",size:"md",bg:"green.100",textAlign:"center",mb:4,p:2,children:"Completed"}):m?e.jsxs(h,{as:"h2",size:"md",bg:"blue.100",mb:4,p:2,children:["Assigned to ",m==null?void 0:m.name]}):e.jsxs(T,{justifyContent:"space-between",alignItems:"center",mb:"4",children:[e.jsxs(h,{as:"h2",size:"md",children:["Order #",i]}),e.jsx(R,{onClick:o,"aria-label":"Allot Waiter",title:"Allot Waiter",icon:e.jsx(W,{}),variant:"outline",colorScheme:"blue"})]}),e.jsx(Y,{mb:"4"}),e.jsxs(G,{spacing:"3",children:[e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Customer"})," ",j||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Phone"})," ",l||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Email"})," ",g||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Guests"})," ",y||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Note"})," ",b||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Total"})," $",p||"0.00"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Table No"})," ",f||"N/A"]})]}),e.jsx(h,{as:"h3",size:"sm",mt:"6",mb:"2",children:"Order Items:"}),e.jsx(F,{children:A==null?void 0:A.map(({_id:O,quantity:n,total:a})=>e.jsxs(L,{children:["Quantity: ",n||"N/A"," - Total: $",a||"0.00"]},O))})]},v)},Se=({orderData:r,handleAllotChef:o})=>{const{_id:v,orderId:u,customerName:m,orderItems:i,totalPrice:j,assignedChef:l,completedAt:g}=r;return e.jsxs(I,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",p:"6",bg:"white",shadow:"lg",transition:"transform 0.2s",_hover:{transform:"scale(1.02)"},children:[g?e.jsx(h,{as:"h2",size:"md",bg:"green.100",textAlign:"center",mb:4,p:2,children:"Completed"}):l?e.jsxs(h,{as:"h2",size:"md",bg:"blue.100",mb:4,p:2,children:["Assigned to ",l==null?void 0:l.name]}):e.jsxs(T,{justifyContent:"space-between",alignItems:"center",mb:"4",children:[e.jsxs(h,{as:"h2",size:"md",mb:4,children:["Order #",u]}),e.jsx(R,{onClick:o,"aria-label":"Allot Chef",title:"Allot Chef",icon:e.jsx(W,{}),variant:"outline",colorScheme:"blue"})]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Customer"})," ",m||"N/A"]}),e.jsxs(t,{mt:2,children:[e.jsx(c,{colorScheme:"blue",children:"Total Price"})," $",j]}),e.jsx(h,{as:"h3",size:"sm",mt:"6",mb:"2",children:"Order Items:"}),e.jsx(F,{children:i==null?void 0:i.map(({_id:y,quantity:b,total:p})=>e.jsxs(L,{children:["Quantity: ",b," - Total: $",p]},y))})]},v)};function q(r){if(!r)return"";const o=r.replace(/([A-Z])/g," $1");return o.charAt(0).toUpperCase()+o.slice(1)}const ve=({orderData:r,handleAllotDeliveryBoy:o})=>{const{_id:v,orderId:u,name:m,phoneNumber:i,paymentMethod:j,deliveryMethod:l,address:g,zip:y,noteFromCustomer:b,totalPrice:p,orderItems:f,assignedTo:A,completedAt:O}=r;return e.jsxs(I,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",p:"6",bg:"white",shadow:"lg",transition:"transform 0.2s",_hover:{transform:"scale(1.02)"},children:[O?e.jsx(h,{as:"h2",size:"md",bg:"green.100",textAlign:"center",mb:4,p:2,children:"Completed"}):A?e.jsxs(h,{as:"h2",size:"md",bg:"blue.100",mb:4,p:2,children:["Assigned to ",A.name]}):e.jsxs(T,{justifyContent:"space-between",alignItems:"center",mb:"4",children:[e.jsxs(h,{as:"h2",size:"md",children:["Order #",u]}),e.jsx(R,{onClick:()=>o(u),"aria-label":"Allot Delivery Boy",title:"Allot Delivery Boy",icon:e.jsx(W,{}),variant:"outline",colorScheme:"blue"})]}),e.jsx(Y,{mb:"4"}),e.jsxs(G,{spacing:"3",children:[e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Customer"})," ",m||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Phone"})," ",i||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Payment"})," ",q(j)||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Delivery"})," ",q(l)||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Address"})," ",g,", ",y]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Note"})," ",b||"N/A"]}),e.jsxs(t,{children:[e.jsx(c,{colorScheme:"blue",children:"Total"})," $",p||"N/A"]})]}),e.jsx(h,{as:"h3",size:"sm",mt:"6",mb:"2",children:"Order Items:"}),e.jsx(F,{children:f==null?void 0:f.map(({_id:n,quantity:a,total:C})=>e.jsxs(L,{children:["Quantity: ",a," - Total: $",C]},n))})]},v)},Be=()=>{const r=ce(),o=Q(),[v,u]=x.useState(!1),[m,i]=x.useState(!1),[j,l]=x.useState(""),[g,y]=x.useState(""),b=E(s=>{var d;return(d=s==null?void 0:s.compOrder)==null?void 0:d.data}),p=E(s=>{var d;return(d=s==null?void 0:s.dineInOrder)==null?void 0:d.order}),f=E(s=>{var d;return(d=s==null?void 0:s.takeAwayOrder)==null?void 0:d.order}),[A,O]=x.useState(!0),[n,a]=x.useState(!0),C=x.useCallback(async()=>{try{const[s,d,k]=await Promise.all([r(ge()),r(ae()),r(de())]);[s,d,k].forEach(P=>{(P==null?void 0:P.status)===403&&O(!1)})}catch(s){o(s.message,"error")}finally{a(!1)}},[r,o]);x.useEffect(()=>{C()},[C]);const D=x.useCallback((s,d)=>{l(s),y(d),d.includes(w.DELIVERY_BOY)?i(!0):u(!0)},[]),S=x.useCallback(s=>{switch(s==null?void 0:s.role){case w.WAITER:r(pe({orderId:j,waiter:s}));break;case w.CHEF:r(he({orderId:j,chef:s}));break;default:console.warn(`Unhandled role: ${s==null?void 0:s.role}`)}},[r,j]),V=s=>{s.map(d=>{r(me({orderId:j,deliveryBoy:d})).then(k=>{o(k.message,k.success?"success":"error")})})};return A?n?e.jsx(T,{justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(re,{size:"xl",thickness:"4px",speed:"0.65s",color:"blue.500"})}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{isOpen:v,setIsOpen:u,onSubmit:S,personnelType:g}),e.jsx(U,{isOpen:m,setIsOpen:i,onSubmit:V,orderId:j}),e.jsx(I,{mt:"8",px:"4",children:e.jsxs(te,{variant:"soft-rounded",colorScheme:"blue",children:[e.jsxs(ie,{children:[e.jsx(B,{children:e.jsx("b",{children:"Delivery"})}),e.jsx(B,{children:e.jsx("b",{children:"Dine-In"})}),e.jsx(B,{children:e.jsx("b",{children:"TakeAway"})})]}),e.jsxs(oe,{children:[e.jsx(M,{children:e.jsxs(I,{maxW:"1200px",mx:"auto",p:"4",children:[e.jsx(h,{as:"h1",size:"xl",mb:"6",textAlign:"center",children:e.jsx("b",{children:"Delivery Orders"})}),b!=null&&b.length?e.jsx(z,{columns:{base:1,md:2,lg:3},spacing:6,children:b.map(s=>e.jsx(ve,{orderData:s,handleAllotDeliveryBoy:()=>D(s==null?void 0:s.orderId,w.DELIVERY_BOY)},s._id))}):e.jsx(t,{textAlign:"center",mt:"4",children:e.jsx("b",{children:"No Delivery Orders"})})]})}),e.jsx(M,{children:e.jsxs(I,{maxW:"1200px",mx:"auto",p:"4",children:[e.jsx(h,{as:"h2",size:"lg",mb:"6",textAlign:"center",children:e.jsx("b",{children:"Dine-In Orders"})}),p!=null&&p.length?e.jsx(z,{columns:{base:1,md:2,lg:3},spacing:6,children:p.map(s=>e.jsx(Ae,{orderData:s,handleAllotWaiter:()=>D(s==null?void 0:s.orderId,w.WAITER)},s._id))}):e.jsx(t,{textAlign:"center",mt:"4",children:e.jsx("b",{children:"No Dine-In Orders"})})]})}),e.jsx(M,{children:e.jsxs(I,{maxW:"1200px",mx:"auto",p:"4",children:[e.jsx(h,{as:"h2",size:"lg",mb:"6",textAlign:"center",children:e.jsx("b",{children:"Takeaway Orders"})}),f!=null&&f.length?e.jsx(z,{columns:{base:1,md:2,lg:3},spacing:6,children:f.map(s=>e.jsx(Se,{orderData:s,handleAllotChef:()=>D(s==null?void 0:s.orderId,w.CHEF)},s._id))}):e.jsx(t,{textAlign:"center",mt:"10",children:e.jsx("b",{children:"No Takeaway Orders"})})]})})]})]})})]}):e.jsx(xe,{isPermitted:A})};export{Be as default};
