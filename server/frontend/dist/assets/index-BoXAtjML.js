import{J as K,j as e,q as W,r as U,s as Y,t as Z,y as Q,v as X,w as $,aa as ee,ab as L,ad as se,R as te,ae as G,M as ae,i as ne,o as v,k as oe,l as re,aC as le,x as ie,a7 as de,z as ce,S as ue,au as me,av as he,aw as pe,ax as R,ay as k,az as xe,aA as j,O as J}from"./chakra-B_DUJliM.js";import{r as c,b as ye}from"./react-D9OIIVWL.js";import{r as V,aA as fe,aB as ge,aC as be,S as je}from"./index-C674oLPn.js";import{A as Ce}from"./chunk-TRO7245M-BL9_MF7v.js";import{u as Se}from"./redux-BFEnBRFN.js";import{g as Ee,a as we,p as Ie,u as ke,d as ve}from"./employee-DTRKjokn.js";import{e as Te}from"./index.esm-CEhDG2xH.js";import{P as Me,p as Oe}from"./index-DBk-HpAQ.js";import{F as Ae}from"./ForbiddenPage-DOSjSRWN.js";import"./toast-D556Fe1H.js";var Pe=K({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"});const _=r=>r?new Date(r).toISOString().split("T")[0]:"",z=r=>r?new Date(r).toISOString():null;function De({isOpen:r,onClose:u,actionType:h,employeeData:m,handleSubmit:T}){var I,x;const f={name:"",email:"",phone:"",country_code:"",address:{street:"",city:"",zipCode:""},birthday:"",nationality:"",maritalStatus:"",children:"",healthInsurance:"",socialSecurityNumber:"",taxID:"",dateOfJoining:"",endOfEmployment:"",role:"",type:"",workingHoursPerWeek:30,variableWorkingHours:!1,annualHolidayEntitlement:"",notes:"",is_online:!1},C=V(),S=(x=(I=JSON.parse(localStorage.getItem("ProfileData")))==null?void 0:I.result)==null?void 0:x.role,[l,i]=c.useState(f);c.useEffect(()=>{h!=="add"&&m&&(i({...m,birthday:_(m.birthday),dateOfJoining:_(m.dateOfJoining),endOfEmployment:_(m.endOfEmployment)}),w(m.permissions.map(s=>s.id)))},[h,m]);const g=s=>{const{name:t,value:o}=s.target;if(t.startsWith("address.")){const y=t.split(".")[1];i(D=>({...D,address:{...D.address,[y]:o}}))}else i(y=>({...y,[t]:o}))},b=s=>{i(t=>({...t,variableWorkingHours:s==="variable"}))},F=s=>{if(i(t=>({...t,phone:s})),typeof s=="string"){const t=Oe(s);t&&i(o=>({...o,country_code:t.countryCallingCode}))}},B=()=>l.name===""||l.email===""||l.phone===""||l.type===""||l.role===""?(C("All required fields must be filled out","error"),!1):!0,M=()=>{if(!B())return;const s=p.filter(o=>P.includes(o.id)).map(o=>({id:o.id,label:o.label.split(" ").join("-")})),t={...l,permissions:s,birthday:z(l.birthday),dateOfJoining:z(l.dateOfJoining),endOfEmployment:z(l.endOfEmployment)};T(t),E()},E=()=>{i(f),w([]),u()},p=[{id:1,label:"Inventory Management"},{id:2,label:"Employee Management"},{id:3,label:"Food And Drinks"},{id:4,label:"Delivery Tracking"}],N=()=>{i({name:"John Doe",email:"nizamji100@gmail.com",country_code:"91",phone:"+911234567890",address:{street:"123 Main St",city:"New York",zipCode:"10001"},birthday:"1990-01-01",role:"Waiter",type:"Full-Time",workingHoursPerWeek:40,annualHolidayEntitlement:20})},O=(s,t)=>t.split(".").reduce((o,y)=>o==null?void 0:o[y],s),n=(s,t,o="text",y=!1,D=[],q=!1)=>e.jsxs(e.Fragment,{children:[s," ",q&&e.jsx("span",{style:{color:"red"},children:"*"}),e.jsx("label",{}),y?e.jsx(de,{name:t,placeholder:"Select option",mb:4,onChange:g,value:O(l,t)||"",children:D.map(H=>e.jsx("option",{value:H,children:H},H))}):e.jsx(W,{name:t,type:o,mb:4,onChange:g,value:O(l,t)||""})]}),A=ye.forwardRef(({inputProps:s,...t},o)=>e.jsx(W,{ref:o,...s,...t}));A.displayName="CustomInput";const[P,w]=c.useState([]),a=s=>P.includes(s),d=s=>{w(t=>t.includes(s)?t.filter(o=>o!==s):[...t,s])};return e.jsxs(U,{isOpen:r,onClose:E,size:"xl",children:[e.jsx(Y,{}),e.jsxs(Z,{maxWidth:{base:"90%",md:"70%"},children:[e.jsx(Q,{}),e.jsx(X,{children:h==="edit"?"Edit Employee":"Add New Employee"}),e.jsxs($,{children:[e.jsxs(ee,{templateColumns:"repeat(12, 1fr)",gap:4,children:[e.jsxs(L,{colSpan:{base:12,md:6},children:[n("Employee name","name","text",!1,[],!0),n("Email","email","email",!1,[],!0),e.jsx(Me,{international:!0,defaultCountry:"DE",value:l.phone,onChange:F,placeholder:"Enter phone number",inputComponent:A,inputProps:{_focus:{borderColor:"#ee7213",boxShadow:"0 0 0 1px #ee7213"}},style:{width:"100%"}}),n("Street","address.street"),n("City","address.city"),n("Zip code","address.zipCode","number"),n("Birthday","birthday","date"),n("Nationality","nationality"),n("Marital status","maritalStatus","text",!0,["Single","Married","Divorced"]),n("Children","children","number")]}),e.jsxs(L,{colSpan:{base:12,md:6},children:[n("Date of joining","dateOfJoining","date"),n("End of employment","endOfEmployment","date"),n("Role","role","text",!0,["Waiter","Manager","Chef","Delivery Boy","Bar Tender","Kitchen Staff","Custom"],!0),n("Type","type","text",!0,["Full-Time","Part-Time","Contract"],!0),e.jsx(se,{onChange:b,value:l.variableWorkingHours?"variable":"fixed",children:e.jsxs(te,{children:[e.jsxs(G,{value:"fixed",children:["Fixed working hours per week",e.jsx(W,{name:"workingHoursPerWeek",type:"number",value:l.variableWorkingHours?"":l.workingHoursPerWeek,onChange:g})]}),e.jsx(G,{value:"variable",children:"Variable working hours"})]})}),n("Annual holiday entitlement (days)","annualHolidayEntitlement","number"),n("Health insurance","healthInsurance"),n("Social security number","socialSecurityNumber","number"),n("Tax ID","taxID","number"),n("Notes","notes")]})]}),S===fe.ADMIN&&e.jsxs(ae,{closeOnSelect:!1,children:[e.jsx(ne,{as:v,rightIcon:e.jsx(Pe,{}),children:"Select Role Access"}),e.jsx(oe,{children:p.map(s=>e.jsx(re,{children:e.jsx(le,{isChecked:a(s.id),onChange:()=>d(s.id),children:s.label})},s.id))})]})]}),e.jsx(ie,{children:h!=="view"?e.jsxs(e.Fragment,{children:[e.jsx(v,{colorScheme:"yellow",mr:3,onClick:N,children:"Auto Fill"}),e.jsx(v,{colorScheme:"blue",mr:3,onClick:E,children:"Close"}),e.jsx(v,{variant:"ghost",backgroundColor:"rgb(33, 180, 152)",color:"white",onClick:M,children:h==="edit"?"Update":"Save"})]}):null})]})]})}function Fe(){const r=V(),u=Se(),[h,m]=c.useState([]),[T,f]=c.useState(""),[C,S]=c.useState("add"),[l,i]=c.useState(!1),[g,b]=c.useState(null),[F,B]=c.useState(!0),[M,E]=c.useState(!0);c.useEffect(()=>{p().finally(()=>B(!1))},[]);const p=async()=>{const a=await u(Ee());a.success?m(a.data):(r(a.message,"error"),a.status===403&&E(!1))},N=async a=>{const d=await u(we(a));d.success&&(console.log(d),b(d.data),f(a),S("edit"),i(!0))},O=async a=>{const d=JSON.parse(localStorage.getItem("ProfileData")).result._id,I={...a,created_by:d};try{const x=await u(Ie(I));x.success?(r("Employee added successfully","success"),p(),i(!1)):r(x.message,"error")}catch(x){r(x.message,"error")}},n=async a=>{if(T)try{const d=await u(ke(T,a));d.success?(r("Employee updated successfully","success"),p(),i(!1)):r(d.message,"error")}catch(d){r(d.message,"error")}},A=async a=>{(await je.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Delete",cancelButtonText:"Cancel"})).isConfirmed&&((await u(ve(a))).success?(r("Employee deleted successfully","success"),p()):r("Failed to delete employee","error"))},P=()=>{S("add"),f(""),b(null),i(!0)},w=()=>{i(!1),f(""),b(null)};return M?F?e.jsx(ce,{height:"50vh",children:e.jsx(ue,{size:"xl"})}):e.jsxs(e.Fragment,{children:[e.jsx(v,{leftIcon:e.jsx(Ce,{}),colorScheme:"teal",variant:"outline",onClick:P,margin:{base:"10px",md:"20px"},children:"Add New Employee"}),e.jsx(me,{style:{backgroundColor:"white",padding:"10px"},children:e.jsxs(he,{variant:"bordered",children:[e.jsx(pe,{children:e.jsxs(R,{children:[e.jsx(k,{style:{borderBottom:"2px solid black"},children:"Name"}),e.jsx(k,{style:{borderBottom:"2px solid black"},children:"Role"}),e.jsx(k,{style:{borderBottom:"2px solid black"},children:"Type"}),e.jsx(k,{style:{borderBottom:"2px solid black"},children:"Phone"}),e.jsx(k,{style:{borderBottom:"2px solid black"},children:"Actions"})]})}),e.jsx(xe,{children:h.length===0?e.jsx(R,{children:e.jsx(j,{colSpan:"5",children:"No Data"})}):h.map(a=>e.jsxs(R,{children:[e.jsx(j,{children:a.name}),e.jsx(j,{children:a.role}),e.jsx(j,{children:a.type}),e.jsx(j,{children:a.phone}),e.jsxs(j,{children:[e.jsx(J,{margin:"0px 2px",colorScheme:"green","aria-label":"View",icon:e.jsx(ge,{}),onClick:()=>{b(a),S("view"),i(!0)}}),e.jsx(J,{margin:"0px 2px",colorScheme:"yellow","aria-label":"Edit",icon:e.jsx(be,{}),onClick:()=>N(a._id)}),e.jsx(J,{margin:"0px 2px",colorScheme:"red","aria-label":"Delete",icon:e.jsx(Te,{}),onClick:()=>A(a._id)})]})]},a._id))})]})}),e.jsx(De,{isOpen:l,onClose:w,actionType:C,employeeData:g,handleSubmit:C==="add"?O:n})]}):e.jsx(Ae,{isPermitted:M})}function Ve(){return e.jsx(Fe,{})}export{Ve as default};
